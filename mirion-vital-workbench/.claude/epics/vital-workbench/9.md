---
name: JSONL Export + Seed Data - Training Format & Samples
status: open
created: 2026-02-06T16:44:03Z
updated: 2026-02-06T16:44:03Z
github: https://github.com/databricks-field-eng/mirion-workspace/issues/9
depends_on: [2, 6]
parallel: true
conflicts_with: []
---

# Task: JSONL Export + Seed Data - Training Format & Samples

## Description

Build the export functionality to convert approved Training Sheets into JSONL format for model fine-tuning. Also create seed data for two validated use cases (PCB defect detection + medical invoice extraction) to enable end-to-end testing and demos.

**Two Deliverables:**
1. **JSONL Export API** - Convert Training Sheet → JSONL for fine-tuning
2. **Seed Data** - Sample Sheets + Canonical Labels + Training Sheets for PCB and invoice use cases

## Acceptance Criteria

### JSONL Export
- [ ] API endpoint: GET `/api/v1/training-sheets/{id}/export/jsonl`
- [ ] Only exports Q&A pairs with `status=labeled` (approved by expert)
- [ ] Respects governance: excludes pairs with `prohibited_uses` containing "training"
- [ ] Output format compatible with Databricks Foundation Model fine-tuning
- [ ] Download as file (Content-Disposition: attachment)
- [ ] Statistics returned: total pairs, exported pairs, excluded pairs (with reasons)

### Seed Data
- [ ] PCB Defect Detection dataset (Sheet + 50 items + 10 canonical labels)
- [ ] Medical Invoice Extraction dataset (Sheet + 30 items + 8 canonical labels)
- [ ] Templates for both use cases (classification, entity_extraction)
- [ ] SQL script to load seed data into Delta tables
- [ ] Sample images for PCB defects in Unity Catalog Volume
- [ ] Sample invoice data (anonymized) in Unity Catalog table

## Technical Details

**JSONL Export Format:**
```jsonl
{"messages": [{"role": "system", "content": "..."}, {"role": "user", "content": "..."}, {"role": "assistant", "content": "..."}]}
{"messages": [{"role": "system", "content": "..."}, {"role": "user", "content": "..."}, {"role": "assistant", "content": "..."}]}
...
```

**Export Endpoint:**
```python
# backend/app/api/v1/training_sheets.py
@router.get("/training-sheets/{training_sheet_id}/export/jsonl")
async def export_jsonl(
    training_sheet_id: str,
    db: DatabricksSession
) -> StreamingResponse:
    # 1. Get all Q&A pairs for Training Sheet
    qa_pairs = qa_pair_service.get_by_training_sheet(training_sheet_id)

    # 2. Filter: only status=labeled AND "training" in allowed_uses
    exportable = [
        qa for qa in qa_pairs
        if qa.status == "labeled"
        and "training" in qa.allowed_uses
        and "training" not in qa.prohibited_uses
    ]

    # 3. Convert to JSONL
    jsonl_content = "\n".join([
        json.dumps({"messages": qa.messages})
        for qa in exportable
    ])

    # 4. Return as downloadable file
    return StreamingResponse(
        io.BytesIO(jsonl_content.encode()),
        media_type="application/jsonl",
        headers={
            "Content-Disposition": f"attachment; filename=training_sheet_{training_sheet_id}.jsonl"
        }
    )
```

**Seed Data Structure:**
```
seed_data/
├── pcb_defects/
│   ├── images/                     # Sample PCB images with defects
│   │   ├── pcb_001_scratch.jpg
│   │   ├── pcb_002_solder_bridge.jpg
│   │   └── ... (50 images)
│   ├── sheet.json                  # Sheet definition
│   ├── canonical_labels.json       # 10 pre-labeled items
│   └── templates.json              # Classification + localization templates
├── medical_invoices/
│   ├── invoices.csv                # Anonymized invoice data
│   ├── sheet.json
│   ├── canonical_labels.json       # 8 pre-labeled items
│   └── templates.json              # Entity extraction template
└── load_seed_data.sql              # SQL script to insert into Delta tables
```

**PCB Seed Data Example:**
```json
// seed_data/pcb_defects/sheet.json
{
  "name": "PCB Defect Detection - Sample",
  "description": "50 PCB inspection images with defect classifications",
  "primary_table": "mirion_vital.samples.pcb_inspections",
  "secondary_sources": [
    {"type": "volume", "path": "/Volumes/mirion_vital/samples/pcb_images", "join_key": "image_id"}
  ],
  "join_keys": ["image_id"]
}

// seed_data/pcb_defects/canonical_labels.json
[
  {
    "sheet_id": "sheet-pcb-sample",
    "item_ref": "pcb_001_scratch.jpg",
    "label_type": "classification",
    "label_data": {
      "defect_type": "scratch",
      "severity": "minor",
      "location": "top_left_quadrant"
    },
    "confidence": "high",
    "labeled_by": "qc_expert@mirion.com"
  },
  ...
]
```

**Files to Create:**
```
backend/app/
└── api/v1/training_sheets.py (add export endpoint)

seed_data/
├── pcb_defects/
│   ├── images/ (50 sample images)
│   ├── sheet.json
│   ├── canonical_labels.json
│   └── templates.json
├── medical_invoices/
│   ├── invoices.csv
│   ├── sheet.json
│   ├── canonical_labels.json
│   └── templates.json
├── load_seed_data.sql
└── README.md (how to load seed data)
```

## Dependencies

- [ ] Task 001 (Delta tables)
- [ ] Task 005 (Q&A Generation Engine)
- [ ] Unity Catalog Volume for storing sample images
- [ ] Anonymized medical invoice data (create synthetic data if needed)

## Effort Estimate

- Size: M
- Hours: 12-16 hours
- Parallel: true (can run alongside Task 006-007)

## Definition of Done

- [ ] Export endpoint returns valid JSONL format
- [ ] Exported file downloads successfully
- [ ] Governance constraints respected (prohibited_uses honored)
- [ ] PCB seed data loaded into Delta tables
- [ ] Medical invoice seed data loaded into Delta tables
- [ ] Sample images accessible in Unity Catalog Volume
- [ ] README documents how to load seed data
- [ ] Manual test: Export PCB Training Sheet → verify JSONL format
- [ ] Manual test: Use exported JSONL with Databricks fine-tuning (optional validation)
- [ ] Backend CLAUDE.md updated with export patterns
