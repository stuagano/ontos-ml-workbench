%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#FF3621','primaryTextColor':'#fff','primaryBorderColor':'#1B3A57','lineColor':'#5f6368','secondaryColor':'#1B3A57','tertiaryColor':'#E8E8E8'}}}%%
flowchart TB
    subgraph Input["Calibration Request"]
        REQ[Customer Portal]
        PARAM[Simulation Parameters]
        REQ --> PARAM
    end

    subgraph GEANT4["GEANT4 on Databricks"]
        G1[R&D Exploration]
        G2[ML Training Data]
        G3[Parameter Sweeps]
        G4[100K+ sims/job]
        G1 --- G2
        G3 --- G4
    end

    subgraph MCNP["MCNP On-Prem / GovCloud"]
        M1[Production Calibrations]
        M2[Regulatory Deliverables]
        M3[Customer Certifications]
        M1 --- M2 --- M3
    end

    subgraph UC["Unity Catalog - All Data Unified"]
        IO[Simulation I/O Data]
        ML[ML Training Datasets]
        LIN[Lineage & Governance]
        IO --- ML --- LIN
    end

    subgraph Output["Customer Delivery"]
        CERT[Calibration Certificate]
        PORT[Customer Portal]
        CERT --> PORT
    end

    PARAM ==>|R&D / ML| GEANT4
    PARAM ==>|Production| MCNP
    GEANT4 ==>|Results| UC
    MCNP ==>|Results| UC
    UC ==>|Certified| CERT

    subgraph Benefits["Hybrid Strategy Benefits"]
        B1["GEANT4: No licensing costs"]
        B2["GEANT4: Elastic compute"]
        B3["MCNP: Regulatory accepted"]
        B4["UC: Cross-engine analytics"]
    end

    style Input fill:#1B3A57,stroke:#FF3621,stroke-width:2px,color:#fff
    style GEANT4 fill:#FF3621,stroke:#1B3A57,stroke-width:3px,color:#fff
    style MCNP fill:#1B3A57,stroke:#FF3621,stroke-width:3px,color:#fff
    style UC fill:#FF3621,stroke:#1B3A57,stroke-width:4px,color:#fff
    style Output fill:#1B3A57,stroke:#FF3621,stroke-width:2px,color:#fff
    style Benefits fill:#E8E8E8,stroke:#5f6368,stroke-width:2px,color:#000
